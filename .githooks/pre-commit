#!/usr/bin/env bash
set -euo pipefail
MAX=$((50*1024*1024))
fail=0
for f in $(git diff --cached --name-only --diff-filter=AM); do
  [ -f "$f" ] || continue
  size=$(wc -c < "$f")
  case "$f" in *.enc|*.out|*.bin|big.*) echo "❌ Blocked: $f"; fail=1;; esac
  [ "$size" -le "$MAX" ] || { echo "❌ Blocked: $f > 50MB"; fail=1; }
done
[ $fail -eq 0 ] || { echo "Use .gitignore / Git LFS."; exit 1; }
